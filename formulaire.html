<!DOCTYPE html>
<html lang="fr">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Formulaire & RÃ©sumÃ© commande</title>

<style>
Â  /* Style gÃ©nÃ©ral noir et blanc */
Â  * {
Â  Â  margin: 0;
Â  Â  padding: 0;
Â  Â  box-sizing: border-box;
Â  Â  font-family: 'Montserrat', sans-serif;
Â  }

Â  body {
Â  Â  background-color: #000;
Â  Â  color: #fff;
Â  Â  line-height: 1.6;
Â  Â  padding: 0;
Â  Â  margin: 0;
Â  }

Â  .header {
Â  Â  background-color: #000;
Â  Â  color: #fff;
Â  Â  padding: 2rem;
Â  Â  text-align: center;
Â  Â  border-bottom: 1px solid #fff;
Â  }

Â  .header h1 {
Â  Â  font-weight: 400;
Â  Â  letter-spacing: 0.5rem;
Â  Â  text-transform: uppercase;
Â  Â  font-size: 1.8rem;
Â  }

Â  .container {
Â  Â  display: flex;
Â  Â  justify-content: space-between;
Â  Â  max-width: 1200px;
Â  Â  margin: 0 auto;
Â  Â  padding: 2rem;
Â  Â  gap: 3rem;
Â  }

Â  /* Formulaire */
Â  #form {
Â  Â  flex: 1;
Â  Â  max-width: 500px;
Â  Â  background-color: #000;
Â  Â  padding: 2rem;
Â  Â  border: 1px solid #fff;
Â  }

Â  #form h2 {
Â  Â  font-weight: 400;
Â  Â  margin-bottom: 2rem;
Â  Â  text-align: center;
Â  Â  letter-spacing: 0.2rem;
Â  Â  text-transform: uppercase;
Â  Â  font-size: 1.5rem;
Â  }

Â  label {
Â  Â  display: block;
Â  Â  margin-bottom: 0.5rem;
Â  Â  font-weight: 300;
Â  Â  letter-spacing: 0.1rem;
Â  }

Â  input {
Â  Â  width: 100%;
Â  Â  padding: 1rem;
Â  Â  margin-bottom: 1.5rem;
Â  Â  background-color: transparent;
Â  Â  border: 1px solid #fff;
Â  Â  color: #fff;
Â  Â  font-size: 1rem;
Â  }

Â  input:focus {
Â  Â  outline: none;
Â  Â  border-color: #fff;
Â  }

button[type="submit"] {
Â  padding: 0.8rem 1.5rem;
Â  font-size: 1rem;
Â  border: 2px solid #ccc;
Â  background-color: #f5f5f5;
Â  color: #333;
Â  cursor: pointer;
Â  transition: all 0.3s ease;
}

/* ğŸ’š Style complÃ¨tement vert si valide */
button[type="submit"].valid {
Â  background-color: #28a745 !important; /* vert */
Â  border-color: #28a745 !important;
Â  color: #fff !important;
}


Â  #message {
Â  Â  margin-top: 1rem;
Â  Â  text-align: center;
Â  Â  font-weight: 300;
Â  }

Â  /* RÃ©sumÃ© commande */
Â  .summary {
Â  Â  flex: 1;
Â  Â  max-width: 500px;
Â  Â  background-color: #000;
Â  Â  padding: 2rem;
Â  Â  border: 1px solid #fff;
Â  }

Â  .summary h3 {
Â  Â  font-weight: 400;
Â  Â  margin-bottom: 2rem;
Â  Â  text-align: center;
Â  Â  letter-spacing: 0.2rem;
Â  Â  text-transform: uppercase;
Â  Â  font-size: 1.5rem;
Â  }

Â  #commande-list {
Â  Â  margin-bottom: 2rem;
Â  }

Â  .article-panier {
Â  Â  display: flex;
Â  Â  justify-content: space-between;
Â  Â  align-items: center;
Â  Â  padding: 1rem 0;
Â  Â  border-bottom: 1px solid #fff;
Â  Â  position: relative;
Â  }

Â  .details-panier {
Â  Â  display: flex;
Â  Â  gap: 1rem;
Â  }

Â  .details-panier img {
Â  Â  width: 80px;
Â  Â  height: 80px;
Â  Â  object-fit: cover;
Â  Â  border: 1px solid #fff;
Â  }

Â  .details-panier h4 {
Â  Â  font-weight: 500;
Â  Â  margin-bottom: 0.5rem;
Â  Â  text-transform: uppercase;
Â  Â  letter-spacing: 0.05rem;
Â  }

Â  .details-panier p {
Â  Â  font-weight: 300;
Â  Â  font-size: 0.9rem;
Â  Â  margin-bottom: 0.3rem;
Â  }

Â  .prix-total {
Â  Â  font-weight: 500;
Â  Â  margin-top: 0.5rem;
Â  }

Â  .supprimer {
Â  Â  background: none;
Â  Â  border: none;
Â  Â  color: #fff;
Â  Â  font-size: 1.5rem;
Â  Â  cursor: pointer;
Â  Â  padding: 0 0.5rem;
Â  }

Â  .commande-total {
Â  Â  text-align: right;
Â  Â  font-size: 1.2rem;
Â  Â  font-weight: 500;
Â  Â  letter-spacing: 0.1rem;
Â  }

Â  /* Corrected CSS for the "Payer" button */
#payer-btn {
Â  display: inline-flex;
Â  align-items: center;
Â  justify-content: center;
Â  padding: 0.8rem 1.5rem;
Â  margin: 2rem;
Â  text-decoration: none;
Â  color: #fff;
Â  border: 1.5px solid #fff;
Â  background: transparent;
Â  font-size: 0.8rem;
Â  letter-spacing: 0.1rem;
Â  font-weight: 500;
Â  text-transform: uppercase;
Â  gap: 0.5rem;
Â  position: relative;
Â  overflow: hidden;
Â  transition: color 0.2s 0.2s;
}

#payer-btn::before {
Â  content: '';
Â  position: absolute;
Â  top: 0;
Â  left: 0;
Â  width: 0;
Â  height: 100%;
Â  background: #fff;
Â  transition: width 0.3s ease-out;
Â  z-index: -1;
}

/* Ã‰lÃ©ments du bouton (texte et icÃ´ne) */
#payer-btn > * {
Â  position: relative;
Â  z-index: 1;
}

#payer-btn:hover {
Â  Â color: #000 !important;
Â  transition-delay: 0.1s;
}

#payer-btn:hover::before {
Â  width: 100%;
}

/* Animation spÃ©cifique pour le prix */
#prix-stripe {
Â  transition: transform 0.2s ease, color 0.2s;
}

#payer-btn:hover #prix-stripe {
Â  color: #000;
Â  transform: translateX(2px);
}

/* Style de l'icÃ´ne */
.btn-icon {
Â  transition: transform 0.2s ease;
}

#payer-btn:hover .btn-icon {
Â  transform: translateX(-3px);
}




#btn-retour {
Â  display: inline-flex;
Â  align-items: center;
Â  justify-content: center;
Â  padding: 0.8rem 1.5rem;
Â  margin: 2rem;
Â  text-decoration: none;
Â  color: #fff;
Â  border: 1.5px solid #fff;
Â  background: transparent;
Â  font-size: 0.8rem;
Â  letter-spacing: 0.1rem;
Â  font-weight: 500;
Â  text-transform: uppercase;
Â  gap: 0.5rem;
Â  position: relative;
Â  overflow: hidden;
Â  transition: color 0.2s 0.2s;
}

#btn-retour::before {
Â  content: '';
Â  position: absolute;
Â  top: 0;
Â  left: 0;
Â  width: 0;
Â  height: 100%;
Â  background: #fff;
Â  transition: width 0.3s ease-out;
Â  z-index: -1;
}


/* Ã‰lÃ©ments du bouton (texte et icÃ´ne) */
#btn-retour > * {
Â  position: relative;
Â  z-index: 1;
}

#btn-retour:hover {
Â  Â color: #000 !important;
Â  transition-delay: 0.1s;
}

#btn-retour:hover::before {
Â  width: 100%;
}


#btn-retour:hover #prix-stripe {
Â  color: #000;
Â  transform: translateX(2px);
}

/* Style de l'icÃ´ne */
.btn-icon {
Â  transition: transform 0.2s ease;
}

#btn-retour:hover .btn-icon {
Â  transform: translateX(-3px);
}






/* Ã‰tat dÃ©sactivÃ© - Ã  garder en dernier pour prioritÃ© */
#payer-btn.btn-disabled {
Â  opacity: 0.5;
Â  cursor: not-allowed;
Â  pointer-events: auto;
}

@keyframes clignoter {
Â  0%, 100% { background-color: red; }
Â  50% { background-color: #ff4d4d; }
}

.btn-error {
Â  background-color: red !important;
Â  animation: clignoter 0.4s ease-in-out 3;
}





</style>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

</head>
<body>

<header class="header">
Â  <h1>COMMANDE</h1>
</header>

<a href="Card.html" id="btn-retour">
Â  Â <span class="btn-icon">â†</span> Retour
</a>

<div class="container">
Â  <form id="form">
Â  Â  <h2>Inscription</h2>

Â  Â  <label for="name">PrÃ©nom</label>
Â  Â  <input type="text" id="name" name="name" required />

Â  Â  <label for="email">Email</label>
Â  Â  <input type="email" id="email" name="email" required />

Â  Â  <button type="submit">Envoyer</button>

Â  Â  <p id="message"></p>
Â  </form>

Â  <div class="summary">
Â  Â  <h3>RÃ©sumÃ© de votre commande</h3>
Â  Â  <div id="commande-list">
Â  Â  Â  <div id="liste-pizzas-panier"></div>
Â  Â  Â  <div id="liste-panier"></div>
Â  Â  </div>
Â  Â  <div id="commande-total" class="commande-total"></div>
Â  Â  <button id="payer-btn">
Â  Â  Â  Â  Payer<span id="prix-stripe"></span>
Â  Â  Â  Â  <span class="btn-icon">â†’</span>
Â  Â  </button>
Â  </div>
</div>

Â  <script src="https://js.stripe.com/v3/"></script>
Â  <script>
Â  Â  Â  Â  // Use DOMContentLoaded to ensure the script runs after the HTML is fully parsed.
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  Â  Â  // Element selections: These variables must find existing HTML elements.
Â  Â  Â  Â  Â  Â  const listePanier = document.getElementById('liste-panier');
Â  Â  Â  Â  Â  Â  const commandeTotal = document.getElementById('commande-total');
Â  Â  Â  Â  Â  Â  const payerBtn = document.getElementById('payer-btn'); // Corrected query selector
Â  Â  Â  Â  Â  Â  const prixStripeSpan = document.getElementById('prix-stripe');
Â  Â  Â  Â  Â  Â  const form = document.getElementById('form');
Â  Â  Â  Â  Â  Â  const message = document.getElementById('message');

Â  Â  Â  Â  Â  Â  // --- Robustness Checks: Log errors if elements are missing ---
Â  Â  Â  Â  Â  Â  if (!listePanier) console.error("Error: Element with ID 'liste-panier' not found.");
Â  Â  Â  Â  Â  Â  if (!commandeTotal) console.error("Error: Element with ID 'commande-total' not found.");
Â  Â  Â  Â  Â  Â  if (!payerBtn) console.error("Error: Element with ID 'payer-btn' not found.");
Â  Â  Â  Â  Â  Â  if (!prixStripeSpan) console.error("Error: Element with ID 'prix-stripe' not found.");
Â  Â  Â  Â  Â  Â  if (!form) console.error("Error: Element with ID 'form' not found.");
Â  Â  Â  Â  Â  Â  if (!message) console.error("Error: Element with ID 'message' not found.");


Â  Â  Â  Â  Â  Â  const supplementsDisponibles = [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sup1', nom: 'OLD SYSTEM / DISABLE', prix: 1.50 },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sup2', nom: 'OLD SYSTEM / DISABLE', prix: 2.00 },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sup3', nom: 'OLD SYSTEM / DISABLE', prix: 1.00 },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sup4', nom: 'OLD SYSTEM / DISABLE ! ', prix: 1.20 },
Â  Â  Â  Â  Â  Â  ];

Â  Â  Â  Â  Â  Â  // Retrieve cart from localStorage or initialize as empty array
Â  Â  Â  Â  Â  Â  let panier = JSON.parse(localStorage.getItem('panier')) || [];

Â  Â  Â  Â  Â  Â  // Add default values for quantity and supplements if missing
Â  Â  Â  Â  Â  Â  panier = panier.map(item => ({
Â  Â  Â  Â  Â  Â  Â  Â  ...item,
Â  Â  Â  Â  Â  Â  Â  Â  quantite: item.quantite || 1,
Â  Â  Â  Â  Â  Â  Â  Â  supplements: item.supplements || []
Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  // Function to calculate the total price of a single item (with supplements)
Â  Â  Â  Â  Â  Â  function calculerPrixTotalItem(item) {
Â  Â  Â  Â  Â  Â  Â  Â  const prixBase = item.prix || 0;
Â  Â  Â  Â  Â  Â  Â  Â  // Assuming supplement prices are already factored into item.prix or handled elsewhere
Â  Â  Â  Â  Â  Â  Â  Â  return prixBase * (item.quantite || 1);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Group identical items in the cart (by id, size, and sorted supplements)
Â  Â  Â  Â  Â  Â  function groupItems(items) {
Â  Â  Â  Â  Â  Â  Â  Â  const groups = [];
Â  Â  Â  Â  Â  Â  Â  Â  items.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const supplementsIdsSorted = item.supplements.map(s => s.id).sort();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const found = groups.find(g => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const gSupplementsIdsSorted = g.supplements.map(s => s.id).sort();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  g.id === item.id &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  g.taille === item.taille &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  JSON.stringify(gSupplementsIdsSorted) === JSON.stringify(supplementsIdsSorted)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (found) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found.items.push(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  groups.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: item.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taille: item.taille,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  supplements: item.supplements,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  items: [item]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  return groups;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Displays the cart content in the DOM
Â  Â  Â  Â  Â  Â  function afficherPanier() {
Â  Â  Â  Â  Â  Â  Â  Â  if (listePanier) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listePanier.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Cannot display cart: 'liste-panier' element not found.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (panier.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listePanier.innerHTML = '<p>Votre panier est vide.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (commandeTotal) commandeTotal.textContent = '0.00 â‚¬';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (payerBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.classList.add('btn-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.setAttribute('aria-disabled', 'true');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (prixStripeSpan) prixStripeSpan.textContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const groupedItems = groupItems(panier);
Â  Â  Â  Â  Â  Â  Â  Â  let total = 0;

Â  Â  Â  Â  Â  Â  Â  Â  groupedItems.forEach(group => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = group.items[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const quantiteTotale = group.items.reduce((acc, it) => acc + (it.quantite || 1), 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const prixTotalGroup = group.items.reduce((sum, it) => sum + calculerPrixTotalItem(it), 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  total += prixTotalGroup;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.classList.add('article-panier');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="details-panier">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.image || 'https://via.placeholder.com/100?text=Produit'}" alt="${item.nom || 'Produit'}" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>${item.nom || 'Article inconnu'} ${quantiteTotale > 1 ? `x${quantiteTotale}` : ''}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Taille :</strong> ${item.taille || 'Standard'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>${item.description || ''}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.supplements && item.supplements.length > 0 ? `<p>SupplÃ©ments : ${item.supplements.map(s => s.nom).join(', ')}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="prix-total">${prixTotalGroup.toFixed(2)} â‚¬</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="supprimer" title="Supprimer cet article">Ã—</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.querySelector('.supprimer').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panier = panier.filter(pItem =>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !(pItem.id === item.id &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pItem.taille === item.taille &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  JSON.stringify(pItem.supplements.map(s => s.id).sort()) === JSON.stringify(item.supplements.map(s => s.id).sort()))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sauvegarderPanier();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  afficherPanier();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listePanier.appendChild(li);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (commandeTotal) commandeTotal.textContent = total.toFixed(2) + ' â‚¬';

Â  Â  Â  Â  Â  Â  Â  Â  // Update "payer" button with total price
Â  Â  Â  Â  Â  Â  Â  Â  if (payerBtn && prixStripeSpan) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (total > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.classList.remove('btn-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.removeAttribute('aria-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  prixStripeSpan.textContent = ` - ${total.toFixed(2)} â‚¬`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.classList.add('btn-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.setAttribute('aria-disabled', 'true');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  prixStripeSpan.textContent = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Save cart to localStorage
Â  Â  Â  Â  Â  Â  function sauvegarderPanier() {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('panier', JSON.stringify(panier));
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Function to launch error animation on the payment button
Â  Â  Â  Â  Â  Â  function lancerAnimationErreur() {
Â  Â  Â  Â  Â  Â  Â  Â  if (payerBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.classList.remove('btn-error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  void payerBtn.offsetWidth;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  payerBtn.classList.add('btn-error');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Attempted to launch error animation, but 'payer-btn' was not found.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Handle form submission
Â  Â  Â  Â  Â  Â  if (form) {
Â  Â  Â  Â  Â  Â  Â  Â  form.addEventListener('submit', async e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const name = form.name.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const email = form.email.value.trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Simple validation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (name === '' || email === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.textContent = 'Veuillez remplir tous les champs.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.style.color = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lancerAnimationErreur();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (panier.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.textContent = 'Votre panier est vide.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.style.color = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lancerAnimationErreur();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Success/info message
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.textContent = 'Informations reÃ§ues, prÃ©paration du paiement...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.style.color = 'green';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- MODIFICATION ICI : RÃ©cupÃ©rer tous les types d'articles ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const panierPizzas = panier.filter(item => item.type === 'pizza');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const panierBoissons = panier.filter(item => item.type === 'boisson');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const panierBurgers = panier.filter(item => item.type === 'burger'); // <--- AJOUTÃ‰
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const panierDesserts = panier.filter(item => item.type === 'dessert'); // <--- AJOUTÃ‰ (si vous avez ce type)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const panierBaseCremes = panier.filter(item => item.type === 'baseCreme'); // <--- AJOUTÃ‰ (si vous avez ce type)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/enregistrer-commande', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panierPizzas,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panierBoissons,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panierBurgers, // <--- AJOUTÃ‰
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panierDesserts, // <--- AJOUTÃ‰
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  panierBaseCremes // <--- AJOUTÃ‰
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const err = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(err.message || 'Erreur inconnue lors de l\'enregistrement de la commande.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!window.Stripe) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.textContent = 'Erreur: La bibliothÃ¨que Stripe.js n\'est pas chargÃ©e.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.style.color = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lancerAnimationErreur();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const stripe = Stripe('pk_test_51RTMhuLFHVbWJugP4qxMRQfifObErZnVAbMeDFwFTGcneOkBYomW3KFhvPHudKzoIn1IvdA6CAbOlL0lbAiNLrX300TLI92CDE');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await stripe.redirectToCheckout({ sessionId: data.sessionId });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (result.error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.textContent = `Erreur Stripe: ${result.error.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.style.color = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lancerAnimationErreur();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.textContent = `Erreur lors du traitement de la commande : ${error.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message.style.color = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lancerAnimationErreur();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Form element with ID 'form' not found. Form submission functionality will not work.");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Initial cart display after all elements are guaranteed to be loaded
Â  Â  Â  Â  Â  Â  afficherPanier();
Â  Â  Â  Â  }); // End DOMContentLoaded listener
Â  Â  </script>
</body>
</html>
